<!-- ======================= social.html ======================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social ‚Äì DataDuels</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .list { width: min(720px, 92%); margin: 0 auto; text-align:left; }
    .item { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; border-bottom:1px solid #e5e7eb; }
    .item:last-child { border-bottom:none; }
    .who { display:flex; align-items:center; gap:12px; }
    .who img { width:40px; height:40px; border-radius:50%; border:1px solid #e5e7eb; }
    .meta { color:#4113ae; font-size:12px; }
    .toolbar { display:flex; gap:8px; justify-content:center; margin-bottom:12px; }
  </style>
</head>
<body>
  <main class="page">
    <section class="card list" aria-label="Social">
      <h1>Social</h1>
      <p>Friends & Leagues (static placeholders for now).</p>

      <div class="toolbar">
        <a class="btn" href="#" aria-disabled="true" onclick="return false;">Find Friends</a>
        <a id="createLeagueBtn" class="btn primary" href="#">Create League</a>
      </div>

      <h2 class="section-title">Your Leagues</h2>
      <p class="meta" id="league-empty">No leagues yet. Create one to get started.</p>
      <div id="league-list"></div>

      <dialog id="leagueDialog" aria-label="Create League">
        <form method="dialog" id="leagueForm" class="form" style="padding:16px;">
          <h3 style="margin:0 0 8px;">Create League</h3>
        
          <!-- League Name -->
          <div>
            <label for="leagueName">League name</label>
            <input id="leagueName" name="name" required placeholder="e.g., Fall 5K Showdown" />
          </div>
        
          <!-- Duration: 1‚Äì2 weeks -->
          <div>
            <label for="leagueDuration">Duration</label>
            <select id="leagueDuration" name="duration" required>
              <option value="1">1 week</option>
              <option value="2" selected>2 weeks</option>
            </select>
            <div class="hint meta">Must be 1‚Äì2 weeks.</div>
          </div>
        
          <!-- League Size: 4‚Äì12 -->
          <div>
            <label for="leagueSize">League size</label>
            <input id="leagueSize" name="size" type="number" min="4" max="12" value="6" required />
            <div class="hint meta">Minimum 4, maximum 12 members (including you).</div>
          </div>
        
          <!-- Invite Members: only friends (checkboxes) -->
          <fieldset style="border:0; padding:0; margin:0;">
            <legend style="font-weight:600; margin-bottom:6px;">Invite members (friends only)</legend>
            <div class="hint meta" style="margin-bottom:6px;">Choose from your friends list below.</div>
            <div class="invite-grid" style="display:grid; gap:8px;">
              <label class="inline"><input type="checkbox" name="invites" value="user1" /> User1</label>
              <label class="inline"><input type="checkbox" name="invites" value="user2" /> User2</label>
              <label class="inline"><input type="checkbox" name="invites" value="user3" /> User3</label>
              <!-- Add more friend checkboxes as you expand the friends list -->
            </div>
          </fieldset>
        
          <div class="row-actions" style="justify-content:flex-end; margin-top:8px;">
            <button type="button" id="leagueCancel" class="btn">Cancel</button>
            <button type="submit" class="btn primary">Create</button>
          </div>
        </form>
      </dialog>


      <h2 style="font-size:16px; margin:8px 0 4px;">Your Friends</h2>
      <div class="item">
        <div class="who">
          <img src="https://api.dicebear.com/7.x/identicon/svg?seed=alex" alt="Alex" />
          <div>
            <div style="font-weight:700;">user1</div>
            <div class="meta">Last run: 5.2 mi ‚Ä¢ +2.1%</div>
          </div>
        </div>
        <a class="btn" href="leaderboards.html">View on Leaderboard</a>
      </div>

      <div class="item">
        <div class="who">
          <img src="https://api.dicebear.com/7.x/identicon/svg?seed=jessica" alt="Jessica" />
          <div>
            <div style="font-weight:700;">user2</div>
            <div class="meta">Last run: 3.1 mi ‚Ä¢ +1.3%</div>
          </div>
        </div>
        <a class="btn" href="leaderboards.html">View on Leaderboard</a>
      </div>

      <div class="item">
        <div class="who">
          <img src="https://api.dicebear.com/7.x/identicon/svg?seed=marcos" alt="Marcos" />
          <div>
            <div style="font-weight:700;">user3</div>
            <div class="meta">Last run: 4.0 mi ‚Ä¢ +0.8%</div>
          </div>
        </div>
        <a class="btn" href="leaderboards.html">View on Leaderboard</a>
      </div>

      <h2 style="font-size:16px; margin:16px 0 4px;">Requests</h2>
      <p class="meta">No pending requests.</p>
    </section>
  </main>

  <!-- Bottom tabs: Profile, Settings, Home, Social, Routes -->
  <nav class="tabs" aria-label="Primary navigation">
    <div class="row">
      <a href="profile.html" aria-label="Profile"><div class="icon">üë§</div><div>Profile</div></a>
      <a href="settings.html" aria-label="Settings"><div class="icon">‚öôÔ∏è</div><div>Settings</div></a>
      <a href="index.html" aria-label="Home"><div class="icon">üè†</div><div>Home</div></a>
      <a href="social.html" aria-label="Social" class="active"><div class="icon">ü´Ç</div><div>Social</div></a>
      <a href="routes.html" aria-label="Routes"><div class="icon">üó∫Ô∏è</div><div>Routes</div></a>
    </div>
  </nav>

  <script src="script.js"></script>
  <script>
  // --- Minimal local leagues manager (no backend) ---
  (function(){
    const KEY = 'dd_leagues_v2'; // bump key so old format doesn't collide

    // Friends allowed to be invited (must match the checkboxes above)
    const FRIENDS = [
      { id: 'user_1', name: 'user1' },
      { id: 'user_2', name: 'user2' },
      { id: 'user_3', name: 'user3' }
    ];

    const dialog = document.getElementById('leagueDialog');
    const openBtn = document.getElementById('createLeagueBtn');
    const cancelBtn = document.getElementById('leagueCancel');
    const form = document.getElementById('leagueForm');
    const list = document.getElementById('league-list');
    const emptyMsg = document.getElementById('league-empty');

    function load(){ try { return JSON.parse(localStorage.getItem(KEY)) || []; } catch(e){ return []; } }
    function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }

    function render(){
      const leagues = load();
      list.innerHTML = '';
      if(!leagues.length){ emptyMsg.style.display = 'block'; return; }
      emptyMsg.style.display = 'none';

      leagues.forEach((lg, i) => {
        const invitedNames = lg.invites.map(id => (FRIENDS.find(f=>f.id===id)?.name || id)).join(', ') || 'No invites';
        const card = document.createElement('div');
        card.className = 'item';
        card.innerHTML = `
          <div>
            <div style="font-weight:700;">${lg.name}</div>
            <div class="meta">
              Duration: ${lg.duration} week${lg.duration>1?'s':''} ‚Ä¢ Size: ${lg.size} ‚Ä¢ Invited: ${invitedNames}
            </div>
          </div>
          <div class="row-actions">
            <a class="btn" href="leaderboards.html">View</a>
            <button class="btn" data-del="${i}">Delete</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    function open(){ dialog?.showModal?.(); }
    function close(){ dialog?.close?.(); }

    openBtn?.addEventListener('click', (e)=>{ e.preventDefault(); open(); });
    cancelBtn?.addEventListener('click', (e)=>{ e.preventDefault(); close(); });

    form?.addEventListener('submit', (e)=>{
      e.preventDefault();

      const name = document.getElementById('leagueName').value.trim();
      const duration = Number(document.getElementById('leagueDuration').value);
      const size = Number(document.getElementById('leagueSize').value);

      // collect checked friend IDs (invites)
      const invites = Array.from(form.querySelectorAll('input[name="invites"]:checked'))
        .map(cb => cb.value)
        // enforce ‚Äúfriends only‚Äù (defensive)
        .filter(id => FRIENDS.some(f => f.id === id));

      // ---- Validation ----
      const errors = [];
      if (!name) errors.push('League name is required.');
      if (!(duration === 1 || duration === 2)) errors.push('Duration must be 1 or 2 weeks.');
      if (!(Number.isInteger(size) && size >= 4 && size <= 12)) errors.push('League size must be an integer from 4 to 12.');
      if (invites.length + 1 > size) errors.push('Invited members + you cannot exceed the league size.');

      if (errors.length) {
        alert(errors.join('\n'));
        return;
      }

      // Save locally
      const leagues = load();
      leagues.push({
        name,
        duration,
        size,
        invites,          // friend IDs only
        createdAt: Date.now()
      });
      save(leagues);

      form.reset();
      close();
      render();
    });

    list?.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-del]');
      if(!btn) return;
      const idx = Number(btn.getAttribute('data-del'));
      const leagues = load();
      leagues.splice(idx, 1);
      save(leagues);
      render();
    });

    // init
    render();
  })();
  </script>

</body>
</html>