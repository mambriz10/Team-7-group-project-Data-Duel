<!-- ======================= profile.html (updated) ======================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile – DataDuels</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .row { display:flex; align-items:center; justify-content:center; gap:16px; margin:12px 0; }
    .statsline { display:flex; gap:24px; justify-content:center; margin:16px 0; }
    .pill { display:inline-block; padding:10px 14px; border:1px solid #e5e7eb; border-radius:999px; background:#fff; font-weight:600; text-decoration:none; }
    .group { display:grid; gap:10px; margin-top:16px; }
  </style>
</head>
<body>
  <main class="page">
    <section class="card" aria-label="Profile">
      <h1>Profile</h1>
      <p>Top-level page for your account.</p>

      <div id="loading" style="text-align:center; padding:20px;">
        <p>Loading profile...</p>
      </div>

      <div id="profileContent" style="display:none;">
        <div class="row">
          <img id="avatar" src="https://api.dicebear.com/7.x/identicon/svg?seed=runner" 
               alt="Avatar" width="64" height="64"
               style="border-radius:50%; border:1px solid #e5e7eb;" />
          <div style="text-align:left;">
            <div id="userName" style="font-weight:700;">Runner Name</div>
            <div id="userInfo" style="color:#666; font-size:14px;">@handle • Location</div>
          </div>
        </div>

        <div id="noDataWarning" style="display:none; padding:12px; margin:12px 0; background:#fef3c7; border:1px solid #fbbf24; border-radius:8px; text-align:center;">
          <p style="margin:0; color:#92400e; font-size:14px;">⚠️ No activity data yet. <a href="index.html" style="color:#92400e; font-weight:600;">Sync your activities</a> to see your stats!</p>
        </div>

        <div class="statsline">
          <div><div id="runs" style="font-weight:700;"></div><div style="color:#666; font-size:12px;">Runs</div></div>
          <div><div id="distance" style="font-weight:700;">0 km</div><div style="color:#666; font-size:12px;">Distance</div></div>
          <div><div id="pace" style="font-weight:700;">0</div><div style="color:#666; font-size:12px;">Avg Pace</div></div>
          <div><div id="score" style="font-weight:700;">0</div><div style="color:#666; font-size:12px;">Score</div></div>
          <div><div id="cadence" style="font-weight:700;">0</div><div style="color:#666; font-size:12px;">Avg Cadence</div></div>
          <div><div id="heartrate" style="font-weight:700;">0</div><div style="color:#666; font-size:12px;">Avg HR</div></div>
          <div><div id="elevation" style="font-weight:700;">0</div><div style="color:#666; font-size:12px;">Elevation</div></div>
        </div>
      </div>

      <div id="error" style="display:none; padding:20px; text-align:center;">
        <p style="color:#ef4444;">[Error] Could not load profile</p>
        <a class="btn" id="connectStravaBtn">Connect Strava</a>
      </div>

      <div class="group" role="navigation" aria-label="Profile subpages">
        <a class="pill" href="profile-challenges.html">Challenges & Badges →</a>
        <a class="pill" href="profile-stats.html">Stats →</a>
      </div>
    </section>
  </main>

  <nav class="tabs" aria-label="Primary navigation">
    <div class="row">
      <a href="profile.html" aria-label="Profile" class="active"><div class="icon">Profile</div></a>
      <a href="settings.html" aria-label="Settings"><div class="icon">Settings</div></a>
      <a href="index.html" aria-label="Home"><div class="icon">Home</div></a>
      <a href="social.html" aria-label="Social"><div class="icon">Social</div></a>
      <a href="routes.html" aria-label="Routes"><div class="icon">Routes</div></a>
    </div>
  </nav>

  <script type="module" src="api.js"></script>
  <script src="script.js"></script>
<<<<<<< HEAD
  <script>
    // Load profile data when page loads
    async function loadProfile() {
      try {
        const data = await api.getProfile();
        console.log(data)
        // Update UI with data
        document.getElementById('userName').textContent = data.name;
        document.getElementById('userInfo').textContent = `@${data.username} • ${data.location}`;
        document.getElementById('avatar').src = data.avatar;
        
        document.getElementById('runs').textContent = data.stats.runs;
        document.getElementById('distance').textContent = data.stats.distance_km + ' km';
        document.getElementById('pace').textContent = data.stats.avg_pace.toFixed(1);
        document.getElementById('score').textContent = data.stats.score;
        
        // Show content, hide loading
        document.getElementById('loading').style.display = 'none';
        document.getElementById('profileContent').style.display = 'block';
      } catch (error) {
        console.error('Failed to load profile:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
      }
    }
=======
  <script type = "module">
    import { API_URL } from './config.js';
>>>>>>> 3ac51834c0adcf582111d844ee2fce13f7ca6764
    
    // Set up Connect Strava button
    document.getElementById('connectStravaBtn')?.addEventListener('click', () => {
      window.location.href = `${API_URL}/auth/strava`;
    });
    
    // Load profile data when page loads
    // async function loadProfile() {
    //   try {
    //     const data = await api.getProfile();
    //     console.log('Profile data loaded:', data);
        
    //     // Update UI with data
    //     document.getElementById('userName').textContent = data.name;
    //     document.getElementById('userInfo').textContent = `@${data.username || 'unknown'} • ${data.location || ''}`;
    //     document.getElementById('avatar').src = data.avatar;
        
    //     document.getElementById('runs').textContent = data.stats.runs || 0;
    //     document.getElementById('distance').textContent = (data.stats.distance_km || 0) + ' km';
    //     document.getElementById('pace').textContent = (data.stats.avg_pace || 0).toFixed(1);
    //     document.getElementById('score').textContent = data.stats.score || 0;
        
    //     // Show warning if no data
    //     if (!data.stats.runs || data.stats.runs === 0) {
    //       document.getElementById('noDataWarning').style.display = 'block';
    //     }
        
    //     // Show content, hide loading
    //     document.getElementById('loading').style.display = 'none';
    //     document.getElementById('profileContent').style.display = 'block';
    //   } catch (error) {
    //     console.error('Failed to load profile:', error);
    //     document.getElementById('loading').style.display = 'none';
    //     document.getElementById('error').style.display = 'block';
    //   }
    // }
    
    // // Load on page ready
    // if (document.readyState === 'loading') {
    //   document.addEventListener('DOMContentLoaded', loadProfile);
    // } else {
    //   loadProfile();
    // }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadProfile_new);
    } else {
      loadProfile_new();
    }

    import { db } from "/strava_user_frontend.js";
    async function loadProfile_new() {
        const { data: { session } } = await db.auth.getSession();
        if (!session) {
            console.error("No active session found!");
            return;
        }

        const res = await fetch(`${API_URL}/person/get-activities`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            access_token: session.access_token
          })

        });

        // Parse the JSON response
        const data = await res.json();

        // // Log it in a readable format
        // console.log(data);
        const stats = {
          username: data.username,
          totalWorkouts: data.total_workouts,
          totalDistance: data.total_distance,
          averageSpeed: data.average_speed,
          maxSpeed: data.max_speed,
          streak: data.streak,
          badges: data.badges,
          weeklyChallenges: data.weekly_challenges
      };

      // Update profile info
      document.getElementById('userName').textContent = stats.username || 'Unknown';
      // You can add location if available in your backend
      document.getElementById('userInfo').textContent = `@${stats.username || 'unknown'}`;
      // If you have an avatar URL, set it; else, default image
      document.getElementById('avatar').src = data.avatar || '/default-avatar.png';

      // Update stats
      document.getElementById('distance').textContent = stats.totalDistance.toFixed(1) + ' km';
      document.getElementById('pace').textContent = stats.averageSpeed 
          ? (1000 / stats.averageSpeed / 60).toFixed(2) + ' min/km'  // m/s -> min/km
          : '0 min/km';
      document.getElementById('score').textContent = stats.totalWorkouts;  // or compute your own score
      document.getElementById('runs').textContent = stats.totalWorkouts;

      // Show warning if no runs
      if (!stats.totalWorkouts || stats.totalWorkouts === 0) {
          document.getElementById('noDataWarning').style.display = 'block';
      } else {
          document.getElementById('noDataWarning').style.display = 'none';
      }

      // Show content, hide loading
      document.getElementById('loading').style.display = 'none';
      document.getElementById('profileContent').style.display = 'block';
    }
    // loadProfile_new();
  </script>
</body>
</html>

